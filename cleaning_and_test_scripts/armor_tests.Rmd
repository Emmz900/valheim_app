---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(here)
library(readxl)
library(janitor)
```

```{r}
armor <- clean_names(read_xlsx(here("raw_data/armour.xlsx")))
sets <- clean_names(read_xlsx(here("raw_data/armour.xlsx"), sheet = 2))
all_items <- clean_names(read_xlsx(here("raw_data/all_crafting.xlsx")))
```

```{r}
sets
```

```{r}
cleaned_armor <- all_items %>% 
  mutate(across(where(is.character), ~ str_to_lower(.x))) %>% 
  select(-c(description, set_bonus)) %>% 
  right_join(armor, by = join_by(item, upgrade_level)) %>% 
  left_join(sets) %>% 
  group_by(item, type, crafting_station_level, crafting_station, upgrade_level,
           armor, resistant, weak, set, weight, speed, other, bonus) %>% 
  summarise(materials = toString(unique(material)),
            material_amounts = toString(amount_of_material)) %>% 
  pivot_wider(names_from = crafting_station, values_from = crafting_station_level) %>% 
  clean_names()
```
```{r}
cleaned_armor %>% 
  filter(type == "cape" & upgrade_level == 1)
```



```{r}
armour %>% 
  filter(upgrade_level == 1) %>% 
  select(item, armor, weight)
```

```{r}
types <- all_items %>% 
  select(item, type) %>% 
  filter(type != "upgrade") %>% 
  distinct()

armour_type <- armour %>% 
  left_join(types)
```
```{r}
armour_type %>% 
  filter(type == "cape" & upgrade_level == 1) %>% 
  select(item, armor, weight, speed, resistant, weak)
```

```{r}
armor <- read_csv(here("clean_data/armor_data.csv"))
```
```{r}
armor %>% 
  rename("upgrade_level" = "Upgrade Level") %>% 
  filter(Type == "Chest" & upgrade_level == 1) %>% 
  select(Item, Armor, Weight, Speed, Resistant, Weak)
```
```{r}
names(armor)
```

```{r}
armor <- armor %>% 
  clean_names() %>% 
  mutate(across(where(is.character), ~ str_to_lower(.x)))

crafting_armor <- all_items %>% 
  semi_join(armor, join_by(item)) %>% 
  mutate(across(where(is.character), ~ str_to_lower(.x)))
```

```{r}
crafting_armor %>% 
  pivot_wider(names_from = crafting_station, values_from = crafting_station_level) %>% 
  clean_names() %>% 
  filter(is.na(workbench) | workbench <= 6) %>% 
  filter(is.na(forge) | forge <= 7) %>%
  filter(is.na(galdr_table) | galdr_table <= 0) %>%
  filter(is.na(black_forge) | black_forge <= 0)
```

```{r}
crafting_armor %>% 
  #filter(item %in% armor_list()) %>% 
  filter(upgrade_level == 1) %>% 
  group_by(item) %>% 
  summarise(materials = toString(unique(material))) %>% 
  #select(item, armor, weight, speed, resistant, weak, materials) %>% 
  mutate(across(where(is.character), ~ str_to_title(.x))) %>% 
  clean_names(case = "title")
```
```{r}
armor
```

